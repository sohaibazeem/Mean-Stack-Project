import{SmartRenderer}from'../../../../../fc-core/src/component-interface';import TimeConverter from'../../../../../fc-utils/src/time-converter';import{getTouchEvent}from'../../../../../fc-core/src/lib';const START='start',END='end';class Label extends SmartRenderer{constructor(){super(),this._dimensions={}}configureAttributes(a={}){super.configureAttributes(a);let b=this.config;for(let c in a)a.hasOwnProperty(c)&&(b[c]=a[c])}__setDefaultConfig(){super.__setDefaultConfig(),this.config.showLabel=!1,this.config.labelStyle={fill:'#f3f3f3',"font-size":'11px',"font-weight":600,"background-color":'#5f5f5f',"border-horizontal-padding":5,"border-vertical-padding":3,"vertical-align":'middle'}}setDimension(a){this._dimensions=a}getDimension(){return this._dimensions}attachHandlers(){let a,b,c,d,f,g,h=this,i=h.getFromEnv('animationManager'),j=h.getLinkedParent(),k=j.getFromEnv('timeNavigator');h.addEventListener('fc-dragstart',h.dragstartHandler||(h.dragstartHandler=function(d){c=getTouchEvent(d).clientX,a=j.getCurrentBrushDimensions(),k.config.labelsGettingDragged=!0,b=d.originalEvent.target,j.config.pointerReleasedOnParent=!1})),h.addEventListener('fc-dragmove',h.dragmoveHandler||(h.dragmoveHandler=function(b){i.setAnimationState('timenavSqueeze'),d=getTouchEvent(b).clientX-c,'leftLabel'===h.config.type?(f=a.x+d,g=a.x+a.width):(f=a.x,g=a.x+a.width+d),k.validateDomain([f,g],h.config.type)})),h.addEventListener('fc-dragend',h.dragendHandler||(h.dragendHandler=function(a){i.setAnimationState('timenavSqueeze'),k.config.labelsGettingDragged=!1,b!==a.originalEvent.target&&j.hideAllLabels()}))}draw(){let a,b,c,d,e,f,g,h,i,j=this,k=j.getFromEnv('baseTextStyle'),l=j.config,m=Object.assign(l.labelStyle,k),n=j.getLinkedParent(),o=j.getFromEnv('timeNavigator').config,p=j.getFromEnv('smartLabel'),q=n.getMaxBrushDimensions(),r=j.getDimension(),s=r.x,t=TimeConverter.formatter('%b %d, %Y'),u='leftLabel'===l.type?o.values[0]:o.values[1],v=t.format(u),w=r.y;p.setStyle({fontSize:m['font-size'],fontFamily:m['font-family'],lineHeight:m['line-height'],fontWeight:m['font-weight']}),c=p.getOriSize(v),'leftLabel'===l.type?s-c.width>=q.x?(b=END,a=1):(b=START,a=-1):s+c.width<=q.x+q.width?(b=START,a=-1):(b=END,a=1),l.showLabel&&(f=c.width,g=c.height,h=f+2*m['border-horizontal-padding'],i=g+2*m['border-vertical-padding'],d=s-a*m['border-horizontal-padding'],e=w-(g+2*m['border-vertical-padding'])/2,j.addGraphicalElement({el:'rect',attr:{x:b===START?s:s-h,y:w-i,width:h,height:i,fill:m['background-color']},css:{cursor:'move'},shadow:[!0,1],label:'dragableLabelBackground',id:l.type+'dragableLabelBackground',component:j,container:{id:'brushGroup',label:'brushGroup',isParent:!0}}),j.addGraphicalElement({el:'text',attr:{x:d,y:e,text:v,"font-family":m['font-family'],"font-style":m['font-style'],"vertical-align":m['vertical-align'],"font-size":m['font-size'],"font-weight":m['font-weight'],"text-anchor":b,fill:m.fill},css:{cursor:'move'},id:l.type+'dragableLabel',label:'dragableLabel',component:j,container:{id:'brushGroup',label:'brushGroup',isParent:!0}}))}}export default Label;